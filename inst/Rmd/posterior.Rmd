```{r posteriorAttach, include=FALSE}
# Attach the DeLorean data frame to access members
attach(dl)
```

## Posterior

### Pseudotime

The estimated pseudotime from the best sample against the observed
capture time.
```{r tauBest}
plot(dl, type="pseudotime")
```

The full tau posterior for each cell.
```{r tauPosterior}
(
    ggplot(samples.l$tau %>% arrange(capture),
           aes(x=cell, y=tau, color=capture))
    + geom_boxplot()
    + coord_flip()
)
```

The posterior of the pseudotime offsets relative to the capture times.
We also show the prior on the offset.
```{r tauPosteriorOffset}
plot(dl, type="tau.offsets")
```

### Cell sizes

The posterior for the cell size factors $S_c$:
```{r posteriorS, eval=opts$estimate.phi}
(ggplot(samples.l$S, aes(x=S))
    + geom_density()
    + geom_rug()
    + stat_function(fun=function(x) dnorm(x,
                                          mean=hyper$mu_S,
                                          sd=hyper$sigma_S),
                    colour="blue", alpha=.7, linetype="dashed")
)
```

The posterior for the cell size factors by cell:
```{r sizeFactorsByCell, eval=opts$estimate.phi}
plot(dl, type="S.posteriors")
```


### Gene means

The posterior for the gene means $\phi_g$:
```{r posteriorPhi, eval=opts$estimate.phi}
(ggplot(samples.l$phi, aes(x=phi))
    + geom_density()
    + geom_rug()
    + stat_function(fun=function(x) dnorm(x,
                                          mean=hyper$mu_phi,
                                          sd=hyper$sigma_phi),
                    colour="blue", alpha=.7, linetype="dashed")
)
```

The posterior for the gene means $\phi_g$ by gene:
```{r posteriorPhiByGene, eval=opts$estimate.phi}
(ggplot(samples.l$phi %>% left_join(gene.map),
        aes(x=gene, y=phi))
    + geom_boxplot()
    + coord_flip())
```

### Between time variation

The posterior for the between time variation $\psi_g$:
```{r posteriorPsi}
(ggplot(samples.l$psi, aes(x=psi))
    + geom_density()
    + geom_rug()
    + stat_function(fun=function(x) dlnorm(x,
                                           mean=hyper$mu_psi,
                                           sd=hyper$sigma_psi),
                    colour="blue", alpha=.7, linetype="dashed")
)
```

Temporal variation by gene:
```{r temporalVariation}
(ggplot(noise.levels,
        aes(x=gene, y=sqrt(psi), fill=gene %in% genes.high.psi),
        environment=environment())
    + geom_boxplot()
    + coord_flip())
```


### Within time variation

The posterior for the within time variation $\omega_g$:
```{r posteriorOmega}
(ggplot(samples.l$omega, aes(x=omega))
    + geom_density()
    + geom_rug()
    + stat_function(fun=function(x) dlnorm(x,
                                           mean=hyper$mu_omega,
                                           sd=hyper$sigma_omega),
                    colour="blue", alpha=.7, linetype="dashed")
)
```

Within time variation by gene:
```{r measurementNoise}
(ggplot(noise.levels,
        aes(x=gene, y=sqrt(omega), fill=gene %in% genes.high.psi),
        environment=environment())
    + geom_boxplot()
    + coord_flip())
```


### Variation comparisons

The within time variation compared to the temporal variation:
```{r noiseScatter}
(ggplot(noise.levels,
        aes(x=sqrt(psi), y=sqrt(omega), color=gene %in% genes.high.psi),
        environment=environment())
    + geom_point()
    + geom_abline(intercept=0, slope=1, linetype="dashed", alpha=.7))
```

Within time variation against temporal variation by gene:
```{r measurementNoiseByGene}
(ggplot(gene.noise.levels,
        aes(x=sqrt(psi), y=sqrt(omega), color=gene %in% genes.high.psi),
        environment=environment())
    + geom_point()
    + geom_abline(intercept=0, slope=1, linetype="dashed", alpha=.7))
```


### Other posteriors

The posterior for the model log probability:
```{r posteriorLP}
(ggplot(samples.l$lp__, aes(x=lp__))
    + geom_density()
    + geom_rug())
```


```{r posteriorDetach, include=FALSE}
# Detach the previously attached DeLorean data frame
detach(dl)
```
